<!DOCTYPE HTML SYSTEM>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Qmeter Report</title>
    <%= stylesheet_link_tag 'qmeter' %>
  </head>
  <body>
    
    <table width="70%" margin="auto" border="1%">
      <tr>
        <th>
          <h3>Security Warnings</h3>
          <div class="pie" style="<%= @brakeman_warnings_rgy %>">
            <div class="title"></div>
            <div class="outer-right mask" id= "10deg"></div>
            <div class="inner-right"></div>

            <div class="outer-left mask">
              <div class="inner-left"></div>
            </div>
            <div class="content">
              <span><%= @brakeman_warnings.count %></span>
            </div>
          </div><p></p>
          <a href="report.html" target="_blank">Report</a>
        </th>

        <th>
          <h3>Rails Best Practise</h3>
          <div class="pie" style="<%= @rails_best_practices_rgy %>">
            <div class="title"></div>
            <div class="outer-right mask" id= "10deg">
            </div>

            <div class="outer-left mask">
              <div class="inner-left"></div>
            </div>
            <div class="content">
              <span><%= @rails_best_practices_info.first['rails_best_practices'] %></span>
            </div>
          </div>
          <p></p>
          <a href="/metric_fu/rails_best_practices.html" target="_blank">Report</a>
        </th>

        <th>
          <h3>Flog</h3>
          <div class="pie" style="<%= @flog_rgy %>">
            <div class="title"></div>
            <div class="outer-right mask" id= "10deg">
              <div class="inner-right"></div>
            </div>

            <div class="outer-left mask">
              <div class="inner-left"></div>
            </div>
            <div class="content">
              <span><%= @flog_info.first['flog'] %></span>
            </div>
          </div><p></p>
          <a href="/metric_fu/flog.html" target="_blank">Report</a>
        </th>

        <th>
          <h3>Stat</h3>
          <div class="pie" style="<%= @stats_rgy %>">
            <div class="title"></div>
            <div class="outer-right mask" id= "10deg">
              <div class="inner-right"></div>
            </div>

            <div class="outer-left mask">
              <div class="inner-left"></div>
            </div>
            <div class="content">
              <span><%= @stats_info.first['stats'] %></span>
            </div>
          </div><p></p>
          <a href="/metric_fu/stats.html" target="_blank">Report</a>
        </th>
      </tr>
    </table>
    <p></p>
    
    <h2>Security Warnings</h2>
    <% @brakeman_warnings.each do |warning| %>
      <li><b><%= warning[0] %></b> => <%= warning[1] %></li>
    <% end %>
    <p></p>

    <p>
      <h2>History</h2>
    
      <h3>flog</h3>
      <canvas id="flog" width="500" height="300" align="center"></canvas>

      <h3>best_practise</h3>
      <canvas id="best_practise" width="500" height="300" align="center"></canvas>

      <h3>stats</h3>
      <canvas id="stats" width="500" height="300" align="center"></canvas>

      <h3>security_warnings</h3>
      <canvas id="security_warnings" width="500" height="300" align="center"></canvas>
    </p>

    <b><%= "Generated on #{Time.now}" %></b>

    <%= javascript_include_tag 'jquery-v1.11.2' %>
    <%= javascript_include_tag 'qmeter' %>
    stylesheet_link_tag
    <script type="text/javascript">
       // Custom JS
      var data = <%= raw @previous_reports.to_json %>;

      var newArray = data[0].map(function(col, i) { 
        return data.map(function(row) { 
          return row[i] 
        })
      });

      time = newArray[newArray.length-1]
      
      arr_flog = newArray[newArray.length-5]
      arr_stats = newArray[newArray.length-4]
      arr_best_practise = newArray[newArray.length-3]
      arr_security_warnings = newArray[newArray.length-2]

      $( document ).ready(function() {

        var flog = {
          node: "flog",
          dataset: arr_flog,
          labels: time,
          pathcolor: "#288ed4",
          fillcolor: "#8e8e8e",
          ybreakperiod: 2,
        };
        drawlineChart(flog);

        var stats = {
          node: "stats",
          dataset: arr_stats,
          labels: time,
          pathcolor: "#288ed4",
          fillcolor: "#8e8e8e",
          xPadding: 0,
          yPadding: 1,
          ybreakperiod: 0.5,
        };
        drawlineChart(stats);

        var best_practise = {
          node: "best_practise",
          dataset: arr_best_practise,
          labels: time,
          pathcolor: "#288ed4",
          fillcolor: "#8e8e8e",
          ybreakperiod: 50
        };
        drawlineChart(best_practise);

        var security_warnings = {
          node: "security_warnings",
          dataset: arr_security_warnings,
          labels: time,
          pathcolor: "#288ed4",
          fillcolor: "#8e8e8e",
          ybreakperiod: 3
        };
        drawlineChart(security_warnings);
      });
    </script>
  </body>
</html>